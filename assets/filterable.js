document.addEventListener("alpine:init",(()=>{Alpine.data("ThemeSection_filterable",(e=>({focusId:"",filterData:[],init(){initTeleport(this.$root),Alpine.store("modals").register("filters","leftDrawer"),Alpine.store("modals").register("sort","rightDrawer"),window.addEventListener("popstate",this.onHistoryChange.bind(this)),this._observeResultsMutations()},filterFormSubmit(e,t){this.focusId=e.target.id,t&&Alpine.store("modals").close(t);let s=e.target.form;"form"===e.target.tagName.toLowerCase()&&(s=e.target);const r=new FormData(s),a=new URLSearchParams(r);a.delete("price_range"),this.renderPage(a.toString(),e)},clearAllFilters(e){Alpine.store("modals").close("filters"),this.renderPage(new URL(e.currentTarget.href).searchParams.toString())},renderPage(t,s,r=!0){document.getElementById("facets-results").classList.add("opacity-50");const a=`${window.location.pathname}?section_id=${e}&${t}`,i=e=>e.url===a;this.filterData.some(i)?this.renderFromCache(i,s):this.renderFromFetch(a,s),r&&this.updateURLHash(t)},renderFromFetch(e,t){fetch(e).then((e=>e.text())).then((t=>{const s=t;this.filterData=[...this.filterData,{html:s,url:e}],this.renderMarkup(s)}))},renderFromCache(e,t){const s=this.filterData.find(e).html;this.renderMarkup(s)},renderMarkup(e){const t=(new DOMParser).parseFromString(e,"text/html"),s=t.getElementById("facets-filterable").innerHTML,r=document.getElementById("facets-filterable");s!==r.innerHTML?(r.closest(".shopify-section").dispatchEvent(new CustomEvent("shapes:section:willmutate",{bubbles:!0})),setTimeout((()=>{r.querySelectorAll("[x-teleport]").forEach((e=>{e.remove()})),r.innerHTML=s,this.$nextTick((()=>{initTeleport(r)}))}),300)):document.getElementById("facets-results").classList.remove("opacity-50");const a=t.getElementById("facets-results-count").innerHTML;liveRegion(a);document.getElementById(this.focusId)&&setTimeout((()=>{document.getElementById(this.focusId).focus()}),50)},updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)},onHistoryChange(e){const t=e.state.searchParams||"";this.renderPage(t,null,!1)},_observeResultsMutations(){const e=document.getElementById("facets-filterable");new MutationObserver(((e,t)=>{e.forEach((e=>{"childList"===e.type&&e.target.closest(".shopify-section").dispatchEvent(new CustomEvent("shapes:section:hasmutated",{bubbles:!0}))}))})).observe(e,{childList:!0,attributes:!1,subtree:!1})}})))}));